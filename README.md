# üí≥ Python-–º–æ–¥—É–ª—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Tinkoff Pay

> –ü—Ä–æ—Å—Ç–∞—è –∏ —á–∏—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π **Tinkoff Pay (Tinkoff –ö–∞—Å—Å–∞)**. –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ –ª—é–±—ã–µ –ø—Ä–æ–µ–∫—Ç—ã: —Å–∞–π—Ç—ã, –±–æ—Ç—ã, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

---

## üìå –û–ø–∏—Å–∞–Ω–∏–µ

–≠—Ç–æ—Ç –º–æ–¥—É–ª—å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —É–¥–æ–±–Ω—É—é –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –æ–±—ë—Ä—Ç–∫—É –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API **Tinkoff Pay**:
- –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –Ω–∞ **Python 3.10+** —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º:
- `aiohttp` ‚Äî –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤
- `loguru` ‚Äî –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- `typing` ‚Äî —Å—Ç—Ä–æ–≥–∏–µ —Ç–∏–ø—ã

---

## ‚úÖ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

| –§—É–Ω–∫—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ                                                                                                          |
|--------|-------------------------------------------------------------------------------------------------------------------|
| `create_payment()` | –°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π –ø–ª–∞—Ç–µ–∂ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Å—ã–ª–∫—É –¥–ª—è –æ–ø–ª–∞—Ç—ã                                                               |
| `check_and_confirm_payment()` | –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞                                                                             |
| `confirm_payment()` | –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –ø–ª–∞—Ç–µ–∂ (–¥–ª—è –¥–≤—É—Ö—Å—Ç–∞–¥–∏–π–Ω–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞)                                                                  |
| `test_create_payment()` | –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è. (–ü—Ä–æ—Å—Ç–æ –≤—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, –≤–µ—Ä–Ω–µ—Ç—Å—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –æ–ø–ª–∞—Ç—É –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª) |

---

## üß© –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### 1. –£—Å—Ç–∞–Ω–æ–≤–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

```bash
pip install aiohttp loguru
```

### 2. –ù–∞—Å—Ç—Ä–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é (payment_config.py):
```
TINKOFF_TERMINAL_KEY = '–≤–∞—à_—Ç–µ—Ä–º–∏–Ω–∞–ª'
TINKOFF_PASSWORD = '–≤–∞—à_–ø–∞—Ä–æ–ª—å'
SUCCESS_URL = 'https://–≤–∞—à—Å–∞–π—Ç.com/success' 
EMAIL = 'email@example.com'
PHONE_NUMBER = '+79991234567'
```

### 3. –í—ã–∑–æ–≤–∏ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞:
```
from payment_system.create_payment import create_payment

async def main():
    await create_payment(title="–ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø–ª–∞—Ç–µ–∂–∞", 
                         description="–û–ø–∏—Å–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞", 
                         price=100.0, 
                         order_number="1234",
                         vat=VatType.NONE)
```

### üì¶VatType
–ö–ª–∞—Å—Å `VatType` –≤—ã–±–æ—Ä –Ω–∞–ª–æ–≥–æ–≤–æ–π —Å—Ç–∞–≤–∫–∏:
```python
class VatType(Enum):
    NONE = "none" # ‚Äî –±–µ–∑ –ù–î–°
    VAT0 = "vat0" # ‚Äî –ù–î–° –ø–æ —Å—Ç–∞–≤–∫–µ 0%
    VAT5 = "vat5" # ‚Äî –ù–î–° –ø–æ —Å—Ç–∞–≤–∫–µ 5%
    VAT7 = "vat7" # ‚Äî –ù–î–° –ø–æ —Å—Ç–∞–≤–∫–µ 7%
    VAT10 = "vat10" # ‚Äî –ù–î–° –ø–æ —Å—Ç–∞–≤–∫–µ 10%
    VAT20 = "vat20" # ‚Äî –ù–î–° –ø–æ —Å—Ç–∞–≤–∫–µ 20%
    VAT105 = "vat105" # ‚Äî –ù–î–° –ø–æ —Ä–∞—Å—á–µ—Ç–Ω–æ–π —Å—Ç–∞–≤–∫–µ 5/105
    VAT107 = "vat107" # ‚Äî –ù–î–° –ø–æ —Ä–∞—Å—á–µ—Ç–Ω–æ–π —Å—Ç–∞–≤–∫–µ 7/107
    VAT110 = "vat110" # ‚Äî –ù–î–° –ø–æ —Ä–∞—Å—á–µ—Ç–Ω–æ–π —Å—Ç–∞–≤–∫–µ 10/110
    VAT120 = "vat120" # ‚Äî –ù–î–° –ø–æ —Ä–∞—Å—á–µ—Ç–Ω–æ–π —Å—Ç–∞–≤–∫–µ 20/120
```


### üì¶build_payment_data()
–§—É–Ω–∫—Ü–∏—è `build_payment_data()` —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞ (—Å—Ç–∞–≤–∫–∞ –ù–î–° –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `–ë–µ–∑ –ù–î–°`).:
```python
def build_payment_data(title: str, description: str, price: float, order_number: str, vat: VatType = VatType.NONE) -> dict:
    """
    –°–æ–∑–¥–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∞.

    Amount —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤ –∫–æ–ø–µ–π–∫–∞—Ö.
    –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —É–º–Ω–æ–∂–µ–Ω–∏–µ –Ω–∞ 100, —á—Ç–æ–±—ã –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ —Ä—É–±–ª–∏ –≤ –∫–æ–ø–µ–π–∫–∏.

    –ü—Ä–∏–º–µ—Ä:
        price = 100 ‚Üí Amount = 10000 –∫–æ–ø–µ–µ–∫ (100 —Ä—É–±–ª–µ–π)
        price = 100.50 ‚Üí int(100.50 * 100) = 10050 –∫–æ–ø–µ–µ–∫ (100 —Ä—É–±–ª–µ–π 50 –∫–æ–ø–µ–µ–∫)

    –ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –¥—Ä–æ–±–Ω—ã–º–∏ —Ü–µ–Ω–∞–º–∏, —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ float –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ,
    –∏–ª–∏ —É–±–µ—Ä–∏—Ç–µ (price * 100) –∏–∑ –∫–æ–¥–∞ –∏ –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ —Å—É–º–º—É –≤ –∫–æ–ø–µ–π–∫–∞—Ö –Ω–∞–ø—Ä—è–º—É—é.
    
    vat - —Ç–∏–ø –ù–î–° (VatType)
    """
    return {
        "TerminalKey": TINKOFF_TERMINAL_KEY,
        "Amount": int(price * 100),
        "OrderId": order_number,
        "Description": description,
        "SuccessURL": SUCCESS_URL,
        "PayType": 'O',
        "DATA": {"Phone": "", "Email": ""},
        "Receipt": {
            "Email": EMAIL,
            "Phone": PHONE_NUMBER,
            "Taxation": "osn",
            "Items": [{
                "Name": title,
                "Price": int(price * 100),
                "Quantity": 1,
                "Amount": int(price * 100),
                "Tax": vat.value,
            }]
        }
    }
```

#### ‚ö†Ô∏è–í–∞–∂–Ω–æ: 
API –¢–∏–Ω—å–∫–æ—Ñ—Ñ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ –∫–æ–ø–µ–µ–∫.
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ float –∞–∫–∫—É—Ä–∞—Ç–Ω–æ, –ª–∏–±–æ –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ —Å—É–º–º—É —Å—Ä–∞–∑—É –≤ –∫–æ–ø–µ–π–∫–∞—Ö –æ—Ç–¥–µ–ª—å–Ω—ã–º –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º.

### üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ 
```
project/
‚îú‚îÄ‚îÄ main.py                  # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îî‚îÄ‚îÄ payment_system/
    ‚îú‚îÄ‚îÄ build_data.py        # –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞
    ‚îú‚îÄ‚îÄ check_and_confirm.py # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞
    ‚îú‚îÄ‚îÄ create_payment.py    # –ò–Ω–∏—Ü–∏–∞—Ü–∏—è –ø–ª–∞—Ç–µ–∂–∞
    ‚îú‚îÄ‚îÄ payment_config.py    # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
    ‚îî‚îÄ‚îÄ utils.py             # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (generate_token, make_tinkoff_request)
```

### üîê –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞ 

–¢–æ–∫–µ–Ω –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º Tinkoff: 

    - –í—Å–µ –ø–æ–ª—è, –∫—Ä–æ–º–µ Receipt, DATA, Shops –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å—Ç—Ä–æ–∫–∏
    - –î–æ–±–∞–≤–ª—è–µ—Ç—Å—è Password
    - –°—Ç—Ä–æ–∫–∞ —Å–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –ø–æ –∫–ª—é—á–∞–º –∏ —Ö—ç—à–∏—Ä—É–µ—Ç—Å—è SHA256

### üì¶ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —ç—Ç–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è 

    ‚ú® –ß–∏—Å—Ç—ã–π –∏ –ø–æ–Ω—è—Ç–Ω—ã–π –∫–æ–¥
    ‚ö° –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (async/await)
    üß™ –õ–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è–µ–º–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
    üìã –û—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –∑–∞–ø—Ä–æ—Å–∞
    üìú –ü–æ–ª–Ω–æ—Å—Ç—å—é –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π
    üìé –ì–æ—Ç–æ–≤ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ –ª—é–±–æ–π –ø—Ä–æ–µ–∫—Ç
     
     
### MIT License ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–æ–µ–∫—Ç –≥–¥–µ —É–≥–æ–¥–Ω–æ, –º–µ–Ω—è–π—Ç–µ –∏ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–π—Ç–µ. 

     
